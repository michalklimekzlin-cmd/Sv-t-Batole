<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Batolesvƒõt ‚Ä¢ Viri</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      color: #9ff;
      font-family: system-ui, -apple-system, sans-serif;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .btn {
      position: fixed;
      padding: 6px 14px;
      border-radius: .6rem;
      border: 1px solid #333;
      background: rgba(40,40,40,.8);
      color: #cbe;
      font-weight: 600;
      backdrop-filter: blur(8px) saturate(120%);
      transition: .3s;
    }

    .btn:hover { background: rgba(70,70,70,.9); }

    #btnTopLeft { top: 20px; left: 20px; }
    #btnTopRight { top: 20px; right: 20px; }
    #btnBottomLeft { bottom: 20px; left: 20px; }
    #btnBottomRight { bottom: 20px; right: 20px; }

    #worldLabel {
      position: fixed;
      bottom: 40px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 18px;
      color: #9ff;
      opacity: .8;
    }

    h3 { margin-bottom: 8px; }
  </style>
</head>

<body>

  <!-- üî∑ ROHOV√â OVL√ÅDAC√ç PRVKY -->
  <div id="btnTopLeft" class="btn">Batolesvƒõt</div>
  <div id="btnTopRight" class="btn">Glyph</div>
  <div id="btnBottomLeft" class="btn">Pedrovci</div>
  <div id="btnBottomRight" class="btn">AI</div>

  <div id="worldLabel">Svƒõt: Michal Klimek</div>

  <!-- üåå VIRI ‚Äì uƒç√≠c√≠ se j√°dro -->
  <section id="viri-core" style="text-align:center; margin-top:40px;">
    <h3 style="color:#9ff;">üåÄ Viri ‚Äì j√°dro uƒçen√≠</h3>
    <canvas id="canvasVafi" width="400" height="400"
      style="background:radial-gradient(circle at center,#001,#000);
             border-radius:50%;
             box-shadow:0 0 30px #0ff;
             margin:auto; display:block;">
    </canvas>
  </section>

  <!-- üß† SCRIPTY A MODULY -->
  <script>
    window.V = (new Date()).toISOString().slice(0,19).replace(/[-:T]/g,'');
  </script>

  <script type="module" src="./config.js?v="+window.V></script>
  <script type="module" src="./state.core.js?v="+window.V></script>
  <script type="module" src="./memory.core.js?v="+window.V></script>
  <script type="module" src="./rules.guardrails.js?v="+window.V></script>
  <script type="module" src="./world.builder.js?v="+window.V></script>
  <script type="module" src="./feeds.ai.js?v="+window.V></script>
  <script type="module" src="./feeds.glyph.js?v="+window.V></script>
  <script type="module" src="./exporter.vafi.js?v="+window.V></script>
  <script type="module" src="./dream.hud.js?v="+window.V></script>

<!-- üå± VIRI FORM ENGINE -->
<script type="module">
  import { startViriForm } from './viri.form.js?v='+window.V;
  import { ViriXP } from './viri.experience.js?v='+window.V;
  import { buildInventory } from './viri.inventory.js?v='+window.V;
  import { initMap } from './map.logic.js?v='+window.V;

  const canvas = document.getElementById('canvasVafi');
  const mapCanvas = document.getElementById('canvasVafi'); // stejn√© pl√°tno
  const xp = new ViriXP();
  const viri = startViriForm(canvas);

  let lastLabel = '';

  async function loop() {
    xp.tick();
    const state = xp.getState(); // { mix, label, mood }
    viri.setMix(state.mix);

    if (state.label !== lastLabel) {
      lastLabel = state.label;
      const inv = await buildInventory(state);
      initMap({ canvas: mapCanvas, inventory: inv });
    }
    requestAnimationFrame(loop);
  }
  loop();

  // üîò testovac√≠ simulace ‚Äî Viri se vyv√≠j√≠ s√°m
  let t = 0;
  setInterval(() => {
    xp.add({ team: 'batolesvet', value: Math.abs(Math.sin(t*0.3))*2 });
    xp.add({ team: 'glyph', value: Math.abs(Math.sin(t*0.5))*2 });
    xp.add({ team: 'ai', value: Math.abs(Math.sin(t*0.7))*2 });
    xp.add({ team: 'pedrovci', value: Math.abs(Math.cos(t*0.4))*2 });
    t += 0.05;
  }, 200);
</script>

<!-- === LEARNING & EVENTS === -->
<script type="module">
- import './events.core.js?v='+window.V;
+ import { EVENTS } from './events.core.js?v='+window.V;
  import { initViriLearning } from './viri.learning.js?v='+window.V;

  // Poƒçkej, a≈æ bude vytvo≈ôen ViriForm (u≈æ ho m√°≈° naho≈ôe jako `viri`)
  const start = () => {
    if(!window.viriForm && !window.viri) return setTimeout(start,50);
    const form = window.viriForm || window.viri;
    initViriLearning(form);

    // Napojen√≠ na rohov√© odznaky
    const L = id => document.getElementById(id);

    L('btnTopLeft')?.addEventListener('click', ()=>{
      EVENTS.ground();
      EVENTS.voice({team:'batole', text:'dr≈æ se', weight:+1});
    });

    L('btnTopRight')?.addEventListener('click', ()=>{
      EVENTS.voice({team:'glyph', text:'‚Üí', weight:+0.6});
      EVENTS.vision({kind:'symbol', truth:Math.random()<0.6?1:0, ttl:4000});
    });

    L('btnBottomLeft')?.addEventListener('click', ()=>{
      EVENTS.voice({team:'pedro', text:'c√≠t√≠m to takhle', weight:+0.5});
      EVENTS.mood({anxiety:-0.05, calm:+0.05});
    });

    L('btnBottomRight')?.addEventListener('click', ()=>{
      EVENTS.voice({team:'ai', text:'anal√Ωza: vpravo', weight:+0.7});
      EVENTS.vision({kind:'path', truth:Math.random()<0.7?1:0, ttl:4000});
    });
  };
  start();
</script>
</body>
</html>